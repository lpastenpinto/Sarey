@model sarey_erp.Models.datosPagoTrabajador
@{
    ViewBag.Title = "datosPago";
}

<div class="content-wrapper" style="min-height:900px !important">
    <br />
    <div class="content">
        <div class="page-header text-center">
            <h2>Datos de pago del trabajador <small>@ViewBag.NombreTrabajador</small></h2>
        </div>
        <div class="col-sm-10 col-sm-offset-1">
            <form action="@Url.Action("guardarDatosPago","Trabajador")" method="post">
                <div class="row">
                    <h4>Datos del Trabajador:</h4>
                </div>
                <div class="row">
                    <div class="col-sm-6">
                        <label class="control-label">Rut:</label>
                        @{
                            string RUT = Model.rut;
                            char[] caracteres = RUT.ToCharArray();
                            RUT = "";
                            for (int i = caracteres.Length-1; i >= 0; i--) 
                            {
                                if (i == caracteres.Length - 1)
                                {
                                    RUT = "-" + caracteres[i] + RUT;
                                }
                                else if (i == caracteres.Length - 4 || i == caracteres.Length - 7)
                                {
                                    RUT = "." + caracteres[i] + RUT;
                                }
                                else
                                {
                                    RUT = caracteres[i] + RUT;
                                }
                            }                            
                        }
                        <input class="form-control" type="text" name="rut" value="@RUT" readonly />
                    </div>
                    <div class="col-sm-6">
                        <label class="control-label">Nombre:</label>
                        <input class="form-control" type="text" name="nombre" value="@ViewBag.NombreTrabajador" readonly />
                    </div>
                </div>
                <br class="hidden-xs" />
                <div class="row">
                    <h4>Imponible:</h4>
                </div>
                <div class="row">
                    <div class="col-sm-6">
                        <label class="control-label">Sueldo Base:</label>
                        <input class="form-control" type="number" name="sueldoBase" id="sueldoBase" value="@Model.sueldoBase" required />
                    </div>
                    <div class="col-sm-6">
                        <label class="control-label">Gratificación mensual:</label>
                        <input class="form-control" type="number" name="gratificacion" id="gratificacion" value="@Model.gratificacion" required />
                    </div>
                </div>
                <br class="hidden-xs" />
                <div class="row">
                    <div class="col-sm-6">
                        <label class="control-label">Bono Producción:</label>
                        <input class="form-control" type="number" name="bonoProduccion" id="bonoProduccion" value="@Model.bonoProduccion" required />
                    </div>
                    <div class="col-sm-6">
                        <label class="control-label">Bono Responsabilidad:</label>
                        <input class="form-control" type="number" name="bonoResponsabilidad" id="bonoResponsabilidad" value="@Model.bonoResponsabilidad" required />
                    </div>
                </div>
                <br class="hidden-xs" />
                <div class="row">
                    <div class="col-sm-6">
                        <label class="control-label">Asignación Familiar:</label>
                        <input class="form-control" type="number" name="asignacionFamiliar" id="asignacionFamiliar" value="@Model.asignacionFamiliar" required />
                    </div>
                    <div class="col-sm-6">
                        <label class="control-label">Total Imponible:</label>
                        <input class="form-control" type="number" name="totalImponible" id="totalImponible"
                               value="@(Model.sueldoBase + Model.gratificacion + Model.bonoProduccion
                        + Model.bonoResponsabilidad + Model.asignacionFamiliar)" readonly />
                    </div>
                </div>
                <br class="hidden-xs" />
                <div class="row">
                    <h4>No imponible:</h4>
                </div>
                <div class="row">
                    <div class="col-sm-6">
                        <label class="control-label">Bono Colación (no imponible):</label>
                        <input class="form-control" type="number" name="bonoColacion" value="@Model.bonoColacion" required />
                    </div>
                    <div class="col-sm-6">
                        <label class="control-label">Bono Movilización (no imponible):</label>
                        <input class="form-control" type="number" name="bonoMovilizacion" value="@Model.bonoMovilizacion" required />
                    </div>
                </div>
                <br class="hidden-xs" />
                <div class="row">
                    <div class="col-sm-6">
                        <label class="control-label">Viático:</label>
                        <input class="form-control" type="number" name="viatico" value="@Model.viatico" required />
                    </div>
                    <div class="col-sm-6">
                        <label class="control-label">Desgaste herramientas:</label>
                        <input class="form-control" type="number" name="desgasteHerramientas" value="@Model.desgasteHerramientas" required />
                    </div>
                </div>
                <br class="hidden-xs" />
                <div class="row">
                    <h4>Horas semanales:</h4>
                </div>
                <div class="row">
                    <div class="col-sm-6">
                        <label class="control-label">Cantidad horas semanales:</label>
                        <input class="form-control" type="number" name="horasSemanales" value="@Model.cantidadHorasSemanales" required />
                    </div>
                </div>
                <div class="clearfix"></div>
                <div class="modal-footer">
                    <a href="@Url.Action("verTrabajador", "Trabajador", new { rut= @Model.rut })" class="btn btn-lg btn-default">Cancelar</a>
                    <button type="submit" class="btn btn-lg btn-primary">Guardar Datos</button>
                </div>
            </form>
        </div>
    </div>
</div>

@section scripts{
    <script type="text/javascript">
        function calcularTotalImponible()
        {
            sueldoBase = $("#sueldoBase").val();

            gratificacion = $("#gratificacion").val();

            bonoProduccion = $("#bonoProduccion").val();

            bonoResponsabilidad = $("#bonoResponsabilidad").val();

            asignacionFamiliar = $("#asignacionFamiliar").val();

            console.log(sueldoBase + " - " + gratificacion + " - " + bonoProduccion + " - " + bonoResponsabilidad + " - " + asignacionFamiliar);

            total = parseInt(sueldoBase) + parseInt(gratificacion) + parseInt(bonoProduccion) + parseInt(bonoResponsabilidad) + parseInt(asignacionFamiliar);

            $("#totalImponible").val(total);
        }

        $("#sueldoBase").change(function () {
            calcularTotalImponible();
        });

        $("#gratificacion").change(function () {
            calcularTotalImponible();
        });

        $("#bonoProduccion").change(function () {
            calcularTotalImponible();
        });

        $("#bonoResponsabilidad").change(function () {
            console.log("HOla");
            calcularTotalImponible();
        });

        $("#asignacionFamiliar").change(function () {
            calcularTotalImponible();
        });

    </script>
}